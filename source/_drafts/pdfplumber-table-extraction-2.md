---
title: pdfplumber是怎么做表格抽取的（二）
copyright: true
date: 2019-12-03 17:42:49
tags:
    - 表格抽取
    - 表格检测
    - 表格识别
    - 开源框架
categories: 表格抽取
description: pdfplumber是一款完全用python开发的pdf解析库，对于线框完全的表格，pdfminer能给出比较好的抽取效果，但是对于线框不完全（包含无线框）的表格，其效果就差了不少。因为在实际项目所需处理的pdf文档中，线框完全及不完全的表格都比较多，所以为了能够理解pdfplumber实现表格抽取的原理和方法，找到改善、提升表格抽取的方法，这里对pdfplubmer的代码逻辑进行了梳理。由于所涉及的内容比较多，所以计划分为三部分进行整理：1. 介绍pdfplumber及其表格抽取流程, 2. 梳理pdfplumber表格线检测逻辑, 3. 梳理pdfplumber表格生成逻辑。本文是第二部分。
---

- [背景介绍](#%e8%83%8c%e6%99%af%e4%bb%8b%e7%bb%8d)
- [得到定义表格的“边”](#%e5%be%97%e5%88%b0%e5%ae%9a%e4%b9%89%e8%a1%a8%e6%a0%bc%e7%9a%84%e8%be%b9)
  - [看得见的边](#%e7%9c%8b%e5%be%97%e8%a7%81%e7%9a%84%e8%be%b9)
  - [看不见的边](#%e7%9c%8b%e4%b8%8d%e8%a7%81%e7%9a%84%e8%be%b9)
  - [额外指定的边](#%e9%a2%9d%e5%a4%96%e6%8c%87%e5%ae%9a%e7%9a%84%e8%be%b9)
- [找到相交的边](#%e6%89%be%e5%88%b0%e7%9b%b8%e4%ba%a4%e7%9a%84%e8%be%b9)

# 背景介绍

最近在做一个表格信息抽取的项目，该项目需要从pdf文件中找到的目标表格，并把目标表格中需要的行和列给抽取出来。由于项目中pdf扫描件占比相对较少（不太到10%吧），所以目前主要把精力花在可编辑pdf文件的表格抽取上。

即便是可编辑的pdf文件，从中抽取表格也不是一件容易的事情，概括起来，难在以下几点：

1. 与其说pdf是一种数据格式，不如说它是一组打印指令的集合，因为pdf文件保存的只是一条条打印指令，这些指令告诉pdf阅读器或打印机该在屏幕或者纸张的什么位置显示什么样的符号。与docx和html等格式的文件不同（docx和html通过标签的方式组织不同的逻辑结构，比如<table>, <w:tbl>, <p>, <w:p>等），pdf文件不包含任何逻辑结构的信息，比如段落、句子、单词、表格等等。在pdf文档中，即便在阅读器中能看到`table-like`的东西，但是却无法直接有效地把这些视觉上`table-like`的东西所对应的数据给抽取出来。
2. 除了不会保存逻辑结构信息之外，pdf往往也不会保存空格、制表符、回车等不可见字符，所以在pdf中无法像在docx中一样，通过制表符来定位不是用线框表示的表格。

为了从pdf中比较好的抽取表格，作者调研、尝试了许多开源的框架（不限于python开发的框架），包括微软开源的深度学习表格检测与识别模型[TableBank](https://github.com/doc-analysis/TableBank)。尝试了一圈下来，在基于python的框架中，pdfplumber和camelot的效果相对较好。对于线框完全的表格，二者都能给出比较好的抽取效果，但是对于线框不完全（包含无线框）的表格，二者的效果就差了不少。

因为在项目所需处理的pdf文档中，线框完全及不完全的表格都比较多，所以为了能够理解pdfplumber实现表格抽取的原理和方法，找到改善、提升表格抽取的方法，作者在这里对pdfplubmer的代码逻辑进行了梳理。由于所涉及的内容比较多，所以计划分为三部分进行整理，分别是：

1. pdfplumber是怎么做表格抽取的（一）：介绍pdfplumber及其表格抽取流程
2. pdfplumber是怎么做表格抽取的（二）：梳理pdfplumber表格线检测逻辑
3. pdfplumber是怎么做表格抽取的（三）：梳理pdfplumber表格生成逻辑

本文是第二部分。

# 得到定义表格的“边”

pdfplumber用三种不同的方式确定pdf文档中可能存在的表格线，分别是：

1. 把可见的线作为候选表格线，这种方式一般用于抽取线框完全的表格。
2. 根据文本的对齐状态，猜测可能的表格线，这种方式一般用于线框不完全的表格。
3. 额外制定表格线，用于辅助线框不完全表格的抽取。

`TableFinder`类中的`get_edges`方法把上述三种不同的方式都包含在内，可以通过配置进行选择，具体如何选择这里就不详细介绍了，感兴趣的读者可以参考[pdfplumber](https://github.com/jsvine/pdfplumber)自身的配置指引。

## 看得见的边

对线框完全的表格，整个表格和各个单元格的边界都是可以用矩形线框表示和区分开来。所以要检测和解析这类表格，需要先把那些可见的、有可能作为表格线的线找出来。

在pdfplumber中，找出可见的线相对比较简单，因为pdfplumber底层是基于pdfminer的，而pdfminer能够把pdf文档中的水平、竖直的线给解析出来。需要注意的是

## 看不见的边

## 额外指定的边


# 找到相交的边